# 个人待办清单后端开发方案（完整版）

> 本文档基于实际开发实现，供其他团队参考使用

---

## 一、项目概述

### 1.1 项目简介

个人待办清单后端服务，基于Spring Boot开发，提供RESTful API接口，支持任务管理、数据统计和待办提醒功能。本项目为单用户个人版，无需用户注册、登录、鉴权。

### 1.2 技术架构

- **核心框架**: Spring Boot 3.1.5
- **Java版本**: Java 17
- **数据存储**: MySQL 8.0+（结构化存储任务主数据）
- **缓存/内存**: Redis（提升性能、辅助定时提醒）
- **ORM框架**: Spring Data JPA / Hibernate
- **API文档**: Swagger/OpenAPI 3
- **构建工具**: Maven 3.6+

### 1.3 项目特点

- 单用户个人版，无需账号注册鉴权
- RESTful API设计，统一JSON响应格式
- 分层架构，代码清晰易维护
- 支持任务增删改查、状态管理、数据统计、提醒功能
- 完整的API文档和单元测试

---

## 二、数据模型设计

### 2.1 数据库表结构

#### 任务表（todo_task）

| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 主键，自增 |
| title | VARCHAR(50) | NOT NULL | 任务标题，必填，限长50 |
| description | VARCHAR(500) | NULL | 任务描述，选填，限长500 |
| status | TINYINT | NOT NULL, DEFAULT 0 | 任务状态：0-未完成，1-已完成 |
| priority | TINYINT | NOT NULL, DEFAULT 2 | 优先级：1-高，2-中，3-低 |
| due_time | DATETIME | NULL | 截止时间，可空 |
| create_time | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 最后更新时间 |
| finish_time | DATETIME | NULL | 完成时间，已完成时记录 |

**索引设计**:
- `idx_status` - 状态索引
- `idx_priority` - 优先级索引
- `idx_due_time` - 截止时间索引
- `idx_create_time` - 创建时间索引

**说明**:
- 物理删除，无历史保留，不做软删
- 使用utf8mb4字符集，支持emoji等特殊字符

### 2.2 枚举类型

#### 任务状态（TaskStatus）

| 值 | 说明 |
|----|------|
| 0 | 未完成 |
| 1 | 已完成 |

#### 优先级（Priority）

| 值 | 说明 |
|----|------|
| 1 | 高 |
| 2 | 中 |
| 3 | 低 |

#### 排序类型（SortType）

| 值 | 说明 |
|----|------|
| latest | 最新添加（默认） |
| dueTime | 即将截止 |
| priority | 优先级 |

---

## 三、系统架构设计

### 3.1 分层架构

```
Controller层 (API接口)
    ↓
Service层 (业务逻辑)
    ↓
Repository层 (数据访问)
    ↓
Entity层 (数据模型)
```

### 3.2 目录结构

```
src/main/java/com/todo/
├── config/          # 配置类
│   ├── GlobalExceptionHandler.java    # 全局异常处理
│   ├── RedisConfig.java               # Redis配置
│   └── SwaggerConfig.java             # Swagger配置
├── controller/      # API控制器层
│   ├── TaskController.java            # 任务管理API
│   ├── StatsController.java           # 数据统计API
│   └── ReminderController.java        # 提醒功能API
├── service/         # 业务逻辑层
│   ├── TaskService.java               # 任务管理服务
│   ├── StatsService.java              # 数据统计服务
│   ├── ReminderService.java           # 提醒服务
│   └── SettingService.java            # 设置服务
├── repository/      # 数据访问层
│   └── TodoTaskRepository.java        # 任务数据访问
├── entity/          # 实体类
│   └── TodoTask.java                  # 任务实体
├── enums/           # 枚举类
│   ├── TaskStatus.java                # 任务状态枚举
│   ├── Priority.java                  # 优先级枚举
│   └── SortType.java                  # 排序类型枚举
├── vo/              # 视图对象/数据传输对象
│   ├── TaskVO.java                    # 任务响应对象
│   ├── TaskCreateRequest.java         # 创建任务请求
│   ├── TaskUpdateRequest.java         # 更新任务请求
│   ├── PageResult.java                # 分页结果
│   ├── StatsVO.java                   # 统计数据响应
│   ├── ReminderVO.java                # 提醒响应对象
│   └── ApiResponse.java               # 统一API响应
├── task/            # 定时任务
│   └── ReminderTask.java              # 提醒定时任务
└── TodoApplication.java               # 启动类
```

### 3.3 核心组件说明

#### Controller层
- **TaskController**: 处理任务相关的HTTP请求，包括增删改查和状态管理
- **StatsController**: 处理数据统计相关的HTTP请求
- **ReminderController**: 处理提醒相关的HTTP请求

#### Service层
- **TaskService**: 实现任务管理的核心业务逻辑
- **StatsService**: 实现数据统计的业务逻辑
- **ReminderService**: 实现提醒扫描和管理的业务逻辑
- **SettingService**: 实现系统设置的管理

#### Repository层
- **TodoTaskRepository**: 提供任务数据的CRUD操作和复杂查询

---

## 四、API接口设计

### 4.1 接口规范

- **基础URL**: `http://localhost:8080`
- **API前缀**: `/api`
- **请求格式**: JSON
- **响应格式**: JSON
- **字符编码**: UTF-8

### 4.2 统一响应格式

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {}
}
```

| 字段 | 类型 | 说明 |
|------|------|------|
| code | Integer | 状态码，200表示成功，其他表示失败 |
| message | String | 响应消息 |
| data | Object/Array | 响应数据 |

### 4.3 接口列表

#### 任务管理接口

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/tasks` | 新增任务 |
| GET | `/api/tasks` | 查询任务列表（支持筛选、排序、分页） |
| GET | `/api/tasks/{id}` | 获取任务详情 |
| PUT | `/api/tasks/{id}` | 编辑任务 |
| DELETE | `/api/tasks/{id}` | 删除任务 |
| PATCH | `/api/tasks/{id}/status` | 标记任务状态 |

#### 数据统计接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/stats/completion` | 完成率统计 |
| GET | `/api/stats/trend` | 任务数量趋势 |
| GET | `/api/stats/distribution` | 状态分布 |

#### 提醒功能接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/reminders` | 获取待提醒任务（长轮询） |
| GET | `/api/settings/reminder` | 获取提醒设置 |
| POST | `/api/settings/reminder` | 设置提醒开关 |

**详细接口文档**: 参见 `docs/api/` 目录下的各接口文档

---

## 五、核心功能实现

### 5.1 任务管理功能

#### 5.1.1 任务创建
- 支持设置标题、描述、截止时间、优先级
- 标题必填，最长50字符
- 描述选填，最长500字符
- 优先级默认2（中）
- 状态默认0（未完成）

#### 5.1.2 任务查询
- 支持按状态筛选（全部/未完成/已完成）
- 支持多种排序方式（最新添加/即将截止/优先级）
- 支持分页查询
- 自动计算逾期状态

#### 5.1.3 任务更新
- 可更新标题、描述、截止时间、优先级
- 不改变任务状态和完成时间
- 自动更新updateTime

#### 5.1.4 任务删除
- 物理删除，不可恢复
- 删除前建议前端二次确认

#### 5.1.5 状态管理
- 支持标记为完成/未完成
- 标记完成时自动记录完成时间
- 标记未完成时清除完成时间

### 5.2 数据统计功能

#### 5.2.1 完成率统计
- 支持指定时间范围（默认7天）
- 计算总体完成率
- 按优先级统计完成率

#### 5.2.2 任务数量趋势
- 支持指定时间范围（默认7天）
- 统计每日新增任务数
- 统计每日完成任务数
- 用于绘制趋势图

#### 5.2.3 状态分布
- 统计当前所有任务的未完成/已完成数量
- 用于绘制饼图

### 5.3 提醒功能

#### 5.3.1 提醒触发条件
- **截止前30分钟提醒**: 任务截止时间在30分钟后触发
- **截止时间提醒**: 任务截止时间到达时触发
- **逾期提醒**: 任务逾期后每24小时提醒一次，最多3次

#### 5.3.2 提醒机制
- 采用长轮询方式，前端定时（建议30秒）调用接口
- 后端定时任务每分钟扫描一次需要提醒的任务
- 使用Redis锁机制防止重复提醒
- 支持全局提醒开关

#### 5.3.3 提醒去重
- 使用Redis分布式锁，锁过期时间5分钟
- 同一任务在同一时间点只会提醒一次
- 逾期提醒最多3次，避免骚扰

---

## 六、技术实现细节

### 6.1 数据库配置

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/todo_db?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
```

### 6.2 Redis配置

```yaml
spring:
  data:
    redis:
      host: localhost
      port: 6379
      password: 
      database: 0
      timeout: 3000ms
```

**Redis用途**:
- 存储提醒设置
- 实现提醒锁机制，防止重复提醒
- 存储提醒计数和最后提醒时间

### 6.3 定时任务

```java
@Scheduled(cron = "0 * * * * ?")  // 每分钟执行一次
public void scanReminders() {
    // 扫描需要提醒的任务
}
```

### 6.4 异常处理

- 全局异常处理器统一处理异常
- 返回统一的错误响应格式
- 记录异常日志

### 6.5 参数验证

- 使用Jakarta Validation进行参数验证
- 自动返回验证错误信息

---

## 七、开发环境配置

### 7.1 环境要求

- JDK 17+
- Maven 3.6+
- MySQL 8.0+
- Redis 6.0+

### 7.2 数据库初始化

执行 `src/main/resources/db/schema.sql` 创建数据库和表：

```bash
mysql -u root -p < src/main/resources/db/schema.sql
```

### 7.3 配置文件

编辑 `src/main/resources/application.yml`，修改数据库和Redis连接信息。

### 7.4 启动服务

```bash
# 使用Maven启动
mvn spring-boot:run

# 或使用IDE运行TodoApplication.java
```

### 7.5 访问文档

- Swagger UI: http://localhost:8080/swagger-ui.html
- API文档: http://localhost:8080/api-docs

---

## 八、测试

### 8.1 单元测试

- **TaskServiceTest**: 任务服务层单元测试
- **TaskControllerTest**: 任务控制器单元测试

### 8.2 测试覆盖

- 任务CRUD操作
- 状态管理
- 参数验证
- 异常处理

### 8.3 测试数据

测试使用H2内存数据库，配置在 `application-test.yml`。

---

## 九、部署说明

### 9.1 开发环境

- 支持本地IDE启动
- 支持Maven命令行启动
- 无需Docker或脚本部署

### 9.2 生产环境建议

- 使用Java 17运行环境
- 配置MySQL连接池
- 配置Redis连接池
- 设置合适的JVM参数
- 配置日志输出

---

## 十、注意事项

### 10.1 业务规则

1. 单用户个人版，无需用户体系与权限控制
2. 所有API均RESTful、返回JSON
3. 状态/优先级/排序分页等均用参数或枚举，默认值合理
4. 定时提醒任务高效保证不重复推送（Redis做短锁防止多推）
5. 代码分层清楚，复杂逻辑均用中文注释简要说明

### 10.2 性能考虑

1. 数据库查询使用索引优化
2. 分页查询避免全表扫描
3. Redis缓存提升性能
4. 定时任务扫描频率合理（每分钟一次）

### 10.3 扩展性

1. 代码结构清晰，易于扩展
2. 接口设计遵循RESTful规范
3. 数据模型设计合理，易于扩展字段

---

## 十一、相关文档

- **需求文档**: `需求文档.md`
- **API接口文档**: `docs/api/` 目录
- **项目README**: `README.md`
- **测试结果**: `测试结果总结.md`

---

## 十二、联系方式

如有问题，请参考：
- Swagger API文档: http://localhost:8080/swagger-ui.html
- 项目代码仓库

---

**文档版本**: 1.0  
**最后更新**: 2025-11-14  
**基于**: 实际开发实现

