# 获取待提醒任务

## 接口信息

- **URL**: `/api/reminders`
- **方法**: `GET`
- **描述**: 长轮询接口，返回需要提醒的任务列表

## 请求参数

无

## 请求说明

此接口采用**长轮询**方式实现提醒功能。前端需要定时（建议30秒）调用此接口，后端会返回当前需要提醒的任务列表。

## 请求示例

```bash
curl http://localhost:8080/api/reminders
```

```javascript
// 定时轮询获取提醒
function pollReminders() {
  fetch('http://localhost:8080/api/reminders')
    .then(response => response.json())
    .then(data => {
      if (data.code === 200 && data.data.length > 0) {
        // 有提醒任务，处理提醒
        data.data.forEach(reminder => {
          showNotification(reminder);
        });
      }
      // 30秒后再次轮询
      setTimeout(pollReminders, 30000);
    });
}

// 启动轮询
pollReminders();
```

## 响应示例

### 成功响应（有提醒任务）

```json
{
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "taskId": 1,
      "title": "完成项目文档",
      "dueTime": "2024-12-31T23:59:00",
      "reminderType": "before30min",
      "message": "任务将在30分钟后截止"
    },
    {
      "taskId": 2,
      "title": "提交代码审查",
      "dueTime": "2024-12-25T12:00:00",
      "reminderType": "due",
      "message": "任务即将截止"
    }
  ]
}
```

### 成功响应（无提醒任务）

```json
{
  "code": 200,
  "message": "操作成功",
  "data": []
}
```

### 成功响应（提醒功能已关闭）

```json
{
  "code": 200,
  "message": "操作成功",
  "data": []
}
```

## 响应字段说明

### data数组元素（ReminderVO）

| 字段 | 类型 | 说明 |
|------|------|------|
| taskId | Long | 任务ID |
| title | String | 任务标题 |
| dueTime | String | 截止时间，ISO 8601格式 |
| reminderType | String | 提醒类型："before30min"（截止前30分钟）、"due"（截止时间）、"overdue"（逾期） |
| message | String | 提醒消息 |

## 提醒触发条件

### 1. 截止时间前30分钟提醒（before30min）
- 触发条件：任务截止时间在30分钟后（允许1分钟误差）
- 提醒消息："任务将在30分钟后截止"

### 2. 截止时间整点提醒（due）
- 触发条件：任务截止时间到达（当前时间前后1分钟内）
- 提醒消息："任务即将截止"

### 3. 逾期提醒（overdue）
- 触发条件：任务已逾期且未完成
- 提醒频率：每24小时提醒一次，最多提醒3次
- 提醒消息："任务已逾期"

## 业务规则

1. 仅对设置了截止时间且未完成的任务触发提醒
2. 如果全局提醒开关已关闭，返回空数组
3. 使用Redis锁机制防止重复提醒
4. 逾期提醒最多3次，避免骚扰用户
5. 前端需要定时轮询此接口（建议30秒间隔）

## 注意事项

1. **轮询频率**：建议前端每30秒调用一次此接口
2. **提醒去重**：后端使用Redis锁机制，同一任务在同一时间点只会提醒一次
3. **提醒开关**：如果提醒功能已关闭，此接口返回空数组
4. **性能考虑**：轮询频率不宜过高，建议30-60秒
5. **前端处理**：收到提醒后，前端可以显示浏览器通知或页面提示

## 前端实现建议

```javascript
// 检查浏览器通知权限
if ('Notification' in window && Notification.permission === 'granted') {
  // 已授权，可以显示通知
}

// 请求通知权限
if ('Notification' in window && Notification.permission === 'default') {
  Notification.requestPermission();
}

// 显示通知
function showNotification(reminder) {
  if (Notification.permission === 'granted') {
    new Notification(reminder.title, {
      body: reminder.message,
      icon: '/icon.png'
    });
  }
  
  // 同时显示页面提示
  showPageNotification(reminder);
}
```

