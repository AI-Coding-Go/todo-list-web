# 标记任务状态

## 接口信息

- **URL**: `/api/tasks/{id}/status`
- **方法**: `PATCH`
- **描述**: 标记任务为完成或未完成

## 请求参数

### Path参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | Long | 是 | 任务ID |

### Query参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| status | Integer | 是 | 任务状态：0-未完成，1-已完成 |

## 请求示例

```bash
# 标记为已完成
curl -X PATCH "http://localhost:8080/api/tasks/1/status?status=1"

# 标记为未完成
curl -X PATCH "http://localhost:8080/api/tasks/1/status?status=0"
```

```javascript
// 标记为已完成
fetch('http://localhost:8080/api/tasks/1/status?status=1', {
  method: 'PATCH'
})
.then(response => response.json())
.then(data => console.log(data));

// 标记为未完成
fetch('http://localhost:8080/api/tasks/1/status?status=0', {
  method: 'PATCH'
})
.then(response => response.json())
.then(data => console.log(data));
```

## 响应示例

### 成功响应（标记为已完成）

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "title": "完成项目文档",
    "description": "编写API文档和用户手册",
    "status": 1,
    "statusDesc": "已完成",
    "priority": 1,
    "priorityDesc": "高",
    "dueTime": "2024-12-31T23:59:00",
    "overdue": false,
    "createTime": "2025-11-14T12:45:38",
    "updateTime": "2025-11-14T12:45:46",
    "finishTime": "2025-11-14T12:45:46.448365"
  }
}
```

### 成功响应（标记为未完成）

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "title": "完成项目文档",
    "description": "编写API文档和用户手册",
    "status": 0,
    "statusDesc": "未完成",
    "priority": 1,
    "priorityDesc": "高",
    "dueTime": "2024-12-31T23:59:00",
    "overdue": true,
    "createTime": "2025-11-14T12:45:38",
    "updateTime": "2025-11-14T12:45:50",
    "finishTime": null
  }
}
```

### 失败响应

```json
{
  "code": 500,
  "message": "任务不存在"
}
```

## 响应字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 任务ID |
| title | String | 任务标题 |
| description | String | 任务描述 |
| status | Integer | 更新后的任务状态：0-未完成，1-已完成 |
| statusDesc | String | 状态描述 |
| priority | Integer | 优先级 |
| priorityDesc | String | 优先级描述 |
| dueTime | String | 截止时间 |
| overdue | Boolean | 是否逾期（仅未完成任务且已过期时为true） |
| createTime | String | 创建时间 |
| updateTime | String | 更新时间（自动更新） |
| finishTime | String | 完成时间。status=1时有值，status=0时为null |

## 业务规则

1. 任务ID必须存在，否则返回错误
2. status参数必须为0或1
3. 标记为已完成（status=1）时：
   - finishTime自动设置为当前时间
   - overdue自动变为false
4. 标记为未完成（status=0）时：
   - finishTime设置为null
   - overdue根据截止时间重新计算
5. 更新后，updateTime自动更新为当前时间

## 注意事项

1. 这是唯一可以修改任务状态的方式
2. 创建任务时不能手动设置状态，默认为未完成
3. 标记为已完成时，会自动记录完成时间
4. 标记为未完成时，会清除完成时间
5. 前端可以通过复选框或按钮触发此接口

