<div class="page-container">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <header class="header">
    <h1 class="title">å¾…åŠæ¸…å•</h1>
  </header>

  <!-- æé†’æ¡ -->
  <div class="reminder-container" *ngIf="activeReminders.length > 0">
    <div 
      class="reminder-bar" 
      *ngFor="let reminder of activeReminders; trackBy: trackByReminderId"
    >
      <div class="reminder-content">
        <strong>{{ reminder.message }}</strong>
        <span *ngIf="reminder.dueDate" class="reminder-time">
          ({{ formatDueDate(reminder.dueDate) }})
        </span>
      </div>
      <div class="reminder-actions">
        <button (click)="handleReminder(reminder)">æŸ¥çœ‹ä»»åŠ¡</button>
        <button (click)="snoozeReminder(reminder)">ç¨åæé†’</button>
        <button (click)="closeReminder(reminder)">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- ä»»åŠ¡åˆ—è¡¨å®¹å™¨ -->
  <div class="task-list-container">
    <!-- ç­›é€‰æ ‡ç­¾ -->
    <div class="filter-tabs">
      <button 
        class="tab" 
        [class.active]="currentFilter === 'all'"
        (click)="setFilter('all')"
      >
        å…¨éƒ¨
      </button>
      <button 
        class="tab" 
        [class.active]="currentFilter === 'pending'"
        (click)="setFilter('pending')"
      >
        æœªå®Œæˆ
      </button>
      <button 
        class="tab" 
        [class.active]="currentFilter === 'completed'"
        (click)="setFilter('completed')"
      >
        å·²å®Œæˆ
      </button>
    </div>

    <!-- æ’åºæŒ‰é’® -->
    <div class="sort-section">
      <button class="sort-btn" (click)="toggleSortOptions()">
        æ’åºï¼š{{ getSortText(currentSort) }}
        <span class="sort-arrow" [class.rotated]="showSortOptions">â–¼</span>
      </button>
      
      <!-- æ’åºé€‰é¡¹ -->
      <div class="sort-options" *ngIf="showSortOptions">
        <div class="sort-option" (click)="setSort('newest')">æœ€æ–°æ·»åŠ </div>
        <div class="sort-option" (click)="setSort('dueDate')">å³å°†æˆªæ­¢</div>
        <div class="sort-option" (click)="setSort('priority')">ä¼˜å…ˆçº§</div>
      </div>
    </div>

    <!-- ä»»åŠ¡åˆ—è¡¨ -->
    <div class="task-list" *ngIf="!isEmpty; else emptyState">
      <div 
        class="task-item" 
        *ngFor="let task of tasks; trackBy: trackByTaskId"
        (click)="viewTaskDetail(task.id)"
        [class.selected]="selectedTaskId === task.id"
      >
        <!-- å¤é€‰æ¡† -->
        <input 
          type="checkbox" 
          class="checkbox"
          [checked]="task.status === 'completed'"
          (click)="toggleTaskStatus(task.id, $event)"
        >

        <!-- ä»»åŠ¡å†…å®¹ -->
        <div class="task-content">
          <div class="task-title" [class.completed]="task.status === 'completed'">
            <span 
              class="priority-label" 
              [ngClass]="'priority-' + task.priority"
            ></span>
            {{ truncateTitle(task.title) }}
          </div>
          <div 
            class="task-time" 
            *ngIf="task.dueDate"
            [class.overdue]="isOverdue(task)"
          >
            <span *ngIf="isOverdue(task)">é€¾æœŸ </span>
            {{ formatDueDate(task.dueDate) }}
          </div>
        </div>

        <!-- ä»»åŠ¡æ“ä½œæŒ‰é’® -->
        <div class="task-actions" *ngIf="selectedTaskId === task.id">
          <button (click)="editTask(task.id, $event)">ç¼–è¾‘</button>
          <button (click)="deleteTask(task.id, $event)">åˆ é™¤</button>
        </div>
      </div>
    </div>

    <!-- ç©ºçŠ¶æ€ -->
    <ng-template #emptyState>
      <div class="empty-state">
        <div class="empty-icon">ğŸ“</div>
        <div class="empty-text">{{ emptyText }}</div>
      </div>
    </ng-template>
  </div>

  <!-- æ‚¬æµ®æ–°å¢æŒ‰é’® -->
  <button class="fab" (click)="addTask()">+</button>
</div>