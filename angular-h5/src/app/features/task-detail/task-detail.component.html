<div class="task-detail-page">
  <!-- 顶部导航栏 -->
  <app-top-bar
    title="任务详情"
    [showBack]="true"
    (back)="onBack()" />

  <!-- 主内容区 -->
  <main class="task-detail-main">
    @if (loading) {
      <div class="loading-state">
        <span>加载中...</span>
      </div>
    } @else if (!task) {
      <div class="empty-state">
        <span>任务不存在</span>
      </div>
    } @else {
      <!-- 任务标题卡片 -->
      <div class="card">
        <div class="priority-badge" [class]="priorityConfig()?.bg">
          <span [class]="priorityConfig()?.text">
            {{ priorityConfig()?.label }}优先级
          </span>
        </div>
        <h1 class="task-title">{{ task.title }}</h1>

        <!-- 状态 -->
        <div class="status-row">
          <span class="status-badge" [class]="getStatusClass()">
            {{ getStatusText() }}
          </span>
          @if (task.status === 'COMPLETED' && task.completedAtFormatted) {
            <span class="complete-time">完成于 {{ task.completedAtFormatted }}</span>
          }
        </div>
      </div>

      <!-- 详细信息卡片 -->
      <div class="card info-card">
        <!-- 截止时间 -->
        <div class="info-row">
          <span class="info-label">截止时间</span>
          <span class="info-value" [class]="isOverdue() ? 'text-red-500' : 'text-gray-900'">
            {{ task.deadlineFormatted || '未设置' }}
            @if (isOverdue()) {
              <span class="overdue-text">（已逾期）</span>
            }
          </span>
        </div>

        <!-- 创建时间 -->
        <div class="info-row">
          <span class="info-label">创建时间</span>
          <span class="info-value">{{ formatFullDateTime(task.createdAt) }}</span>
        </div>

        <!-- 更新时间 -->
        <div class="info-row">
          <span class="info-label">更新时间</span>
          <span class="info-value">{{ formatFullDateTime(task.updatedAt) }}</span>
        </div>
      </div>

      <!-- 任务描述 -->
      @if (task.description) {
        <div class="card">
          <h3 class="section-title">任务描述</h3>
          <p class="task-description">{{ task.description }}</p>
        </div>
      }

      <!-- 操作按钮 -->
      <div class="card actions-card">
        <!-- 标记状态按钮 -->
        <button
          class="action-btn"
          (click)="onToggleStatus()"
          [disabled]="actionLoading">
          <span class="action-btn-text">{{ getToggleButtonText() }}</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            @if (task.status === 'COMPLETED') {
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
            } @else {
              <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            }
          </svg>
        </button>

        <!-- 编辑按钮 -->
        <button class="action-btn" (click)="onEdit()">
          <span class="action-btn-text">编辑任务</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
        </button>

        <!-- 删除按钮 -->
        <button class="action-btn delete-btn" (click)="onDelete()">
          <span class="action-btn-text">删除任务</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" />
          </svg>
        </button>
      </div>
    }
  </main>

  <!-- 删除确认弹窗 -->
  <app-confirm-dialog
    [open]="showDeleteConfirm"
    title="确定删除该任务？删除后不可恢复"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()" />
</div>
